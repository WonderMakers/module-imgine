!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var o in r)("object"==typeof exports?exports:t)[o]=r[o]}}(global,(()=>(()=>{"use strict";var t={};(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);const{parseQuery:e,getOptions:r,interpolateName:o}=require("loader-utils"),n=require("../node-converter/index.js"),a=require("sharp"),i=require("path"),s=require("./options.json"),f=new n(a,{fetchCacheLimit:0});async function u({file:t,rootContext:e,name:r,transformOptions:n}){const a=r.replace(/\[ext\]/gi,n.f).replace(/\[width\]/gi,n.w||""),s=o(this,a,{context:e,content:t.buffer}),u=await f.sharping({url:t.url,buffer:t.url},n);let c=i.posix.join("",s),l=`__webpack_public_path__ + ${JSON.stringify(c)}`;if(u)return this.emitFile(c,u.buffer,null),{path:l,srcset:l+`+${JSON.stringify(` ${n.w}w`)}`,width:n.w,type:u.contentType,format:u.format}}function c(t){return`{ path: ${t.path}${t.width?`, width: ${t.width}`:""}, format: "${t.format}", type: "${t.type}" }`}return module.exports=async function(t){const o=this.async(),n=[],{rootContext:a,resourcePath:f}=this,l={buffer:t,url:f,ext:i.extname(f).replace(/\./,"")};if(void 0===o)return void new Error("Imagine loader callback error");const p=this.resourceQuery?e(this.resourceQuery):{},m=Object.assign({},s);m.formats=Object.assign([],s.formats);const h=Object.assign({},m,r(this),p);h.map=function(t=[]){return t.reduce(((t,e)=>(t.includes(e)||t.push(e),t)),[]).sort(((t,e)=>t-e))}(h.map),h.formats.push(l.ext),h.formats=function(t=[]){const e=function(t){switch(t){case"avif":return 0;case"webp":return 1;case"png":return 2;case"jpg":return 3}};return t.reduce(((t,e)=>{return e="jpg"===(r=(r=e).toLocaleString())?"jpeg":r,t.includes(e)||t.push(e),t;var r}),[]).sort(((t,r)=>e(t)-e(r)))}(h.formats),h.formats.forEach((t=>{h.map.forEach((e=>{const r={w:e,b:h.blur,r:h.rotate,q:h.quality,f:t};n.push(u.call(this,{rootContext:a,transformOptions:r,name:h.name,file:l}))}))}));const d=await u.call(this,{rootContext:a,name:h.name,file:l,transformOptions:{w:40,b:2,r:h.rotate,f:l.ext}}),y=await u.call(this,{rootContext:a,name:h.name,file:l,transformOptions:{r:h.rotate,f:l.ext}});Promise.all(n).then((t=>{const e=h.formats.map((e=>{const r=t.filter((t=>t.format===e));return r.length?`{ format: "${e}", type: "${r[0].type}", srcset: ${r.map((t=>t.srcset)).join('+","+')}}`:null})).filter(Boolean),r=`${h.esModule?"export default":"module.exports ="} {\n        formats: [${e}],\n        original: ${c(y)},\n        placeholder: ${c(d)},\n        toString: function(){return ${y.path}},\n      }`;o(null,r)}))},t})()));