(()=>{"use strict";var A={d:(t,e)=>{for(var s in e)A.o(e,s)&&!A.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o:(A,t)=>Object.prototype.hasOwnProperty.call(A,t)},t={};A.d(t,{default:()=>s});class e{constructor(A,t){this.isDev=t,this.options=A,this.favoriteFormat=null,this.setup()}setup(){process.client&&this.checkSupports()}async checkSupports(){this.isSupporAvif=await this.isSupportImageData("data:image/avif;base64,AAAAFGZ0eXBhdmlmAAAAAG1pZjEAAACgbWV0YQAAAAAAAAAOcGl0bQAAAAAAAQAAAB5pbG9jAAAAAEQAAAEAAQAAAAEAAAC8AAAAGwAAACNpaW5mAAAAAAABAAAAFWluZmUCAAAAAAEAAGF2MDEAAAAARWlwcnAAAAAoaXBjbwAAABRpc3BlAAAAAAAAAAQAAAAEAAAADGF2MUOBAAAAAAAAFWlwbWEAAAAAAAAAAQABAgECAAAAI21kYXQSAAoIP8R8hAQ0BUAyDWeeUy0JG+QAACANEkA="),this.isSupportWebp=await this.isSupportImageData("data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoCAAEAAQAcJaQAA3AA/v3AgAA="),this.isSupporAvif?(document.documentElement.classList.add("avif"),this.favoriteFormat="avif"):this.isSupportWebp&&(document.documentElement.classList.add("webp"),this.favoriteFormat="webp")}async isSupportImageData(A){if(!createImageBitmap)return!1;const t=await fetch(A).then((A=>A.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))}format(A="",t={}){const e=this.isDev?`/${this.options.namespace}/`:this.options.endpoint,s=A.search(/^https?:\/\//)>-1;let i=A.replace(/^\//,"").replace(/\?.+$/,""),a=this.getQuery(A,t);return this.favoriteFormat&&void 0===t.f&&!a.f&&(a.f=this.favoriteFormat),s||this.isDev||(i=this.options.staticEndpoint+i),e+i+this.getQueryString(a)}getQuery(A,t={}){const e=A.match(/\?(.+)$/);let s={};return e&&(s=e[0].replace(/^\?/,"").split("&").reduce(((A,t)=>{const e=t.split("=");return A[e[0]]=e[1],A}),{})),Object.assign({},s,t)}getQueryString(A){const t=Object.keys(A).reduce(((t,e)=>{const s=A[e];return s&&t.push(`${e}=${s}`),t}),[]).join("&");return t?"?"+t:""}}const s=({app:A},t)=>{const s=A.context.isDev,i=JSON.parse('<%= JSON.stringify(options).replace(/^"/, "\'").replace(/"$/, "\'") %>');t("imgine",new e(i,s))};module.exports=t.default})();